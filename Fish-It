-- ğŸ£ Fish It Discord Notifier â€” Delta Executor (Roblox)
-- âœ… Deteksi perubahan di leaderstats.Caught
-- âœ… Input webhook manual via GUI
-- âœ… Debug log untuk cek perubahan

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")

-- ==============================================
-- ğŸ–¼ï¸ BUAT GUI INPUT WEBHOOK
-- ==============================================
local function createWebhookInputGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FishItWebhookSetup"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = nil

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 180)
    frame.Position = UDim2.new(0.5, -150, 0.5, -90)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 40)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "ğŸ£ Fish It Notifier Setup"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.Parent = frame

    local inputBox = Instance.new("TextBox")
    inputBox.Size = UDim2.new(0.9, 0, 0, 35)
    inputBox.Position = UDim2.new(0.05, 0, 0, 50)
    inputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    inputBox.TextColor3 = Color3.fromRGB(220, 220, 220)
    inputBox.Font = Enum.Font.SourceSans
    inputBox.TextSize = 14
    inputBox.PlaceholderText = "Paste Webhook URL di sini..."
    inputBox.Parent = frame

    local submitBtn = Instance.new("TextButton")
    submitBtn.Size = UDim2.new(0.9, 0, 0, 40)
    submitBtn.Position = UDim2.new(0.05, 0, 0, 95)
    submitBtn.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
    submitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    submitBtn.Font = Enum.Font.GothamBold
    submitBtn.TextSize = 15
    submitBtn.Text = "âœ… Submit & Mulai Notif"
    submitBtn.Parent = frame

    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, 0, 0, 30)
    statusLabel.Position = UDim2.new(0, 0, 0, 140)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = ""
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    statusLabel.Font = Enum.Font.SourceSans
    statusLabel.TextSize = 13
    statusLabel.TextWrapped = true
    statusLabel.Parent = frame

    return screenGui, inputBox, submitBtn, statusLabel
end

-- ==============================================
-- ğŸ“¤ KIRIM NOTIF KE DISCORD
-- ==============================================
local function sendToDiscord(webhookUrl, fishName, rarity)
    local payload = {
        ["username"] = "ğŸ£ Fish It Notifier",
        ["avatar_url"] = "https://i.imgur.com/fish-icon.png",
        ["embeds"] = {{
            ["title"] = "ğŸ‰ Ikan Didapat!",
            ["description"] = "**" .. LocalPlayer.Name .. "** baru saja menangkap:\n> **" .. (fishName or "Ikan Misterius") .. "**",
            ["color"] = 0x3498db,
            ["fields"] = {{
                ["name"] = "â­ Rarity",
                ["value"] = rarity or "Tidak Diketahui",
                ["inline"] = true
            }},
            ["footer"] = {
                ["text"] = "Auto Notif â€¢ via Delta Executor",
                ["icon_url"] = "https://i.imgur.com/water-wave.png"
            },
            ["thumbnail"] = {
                ["url"] = "https://i.imgur.com/fish-emoji.png"
            }
        }}
    }

    local success, response = pcall(function()
        return request({
            Url = webhookUrl,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode(payload)
        })
    end)

    if success then
        print("âœ… Notif terkirim: " .. fishName)
    else
        warn("âŒ Gagal kirim notif:", response)
    end
end

-- ==============================================
-- ğŸŸ DETEKSI PERUBAHAN DI LEADERSTATS.CAUGHT
-- ==============================================
local function startFishListener(webhookUrl)
    local player = LocalPlayer
    local leaderstats = player:WaitForChild("leaderstats")
    local caught = leaderstats:WaitForChild("Caught")

    -- Cek apakah Caught adalah NumberValue atau IntValue
    if caught:IsA("NumberValue") or caught:IsA("IntValue") then
        local oldValue = caught.Value
        caught.Changed:Connect(function()
            local newValue = caught.Value
            if newValue > oldValue then
                print("ğŸ”§ Caught bertambah dari", oldValue, "ke", newValue)
                sendToDiscord(webhookUrl, "Ikan Baru", "?")
                oldValue = newValue
            end
        end)
    else
        warn("âŒ 'Caught' bukan NumberValue atau IntValue!")
    end

    print("âœ… Sistem notifikasi aktif!")
end

-- ==============================================
-- ğŸš€ JALANKAN SETUP GUI
-- ==============================================
print("ğŸš€ Menyiapkan Fish It Discord Notifier...")

local playerGui = LocalPlayer:WaitForChild("PlayerGui")
local gui, inputBox, submitBtn, statusLabel = createWebhookInputGUI()
gui.Parent = playerGui

submitBtn.MouseButton1Click:Connect(function()
    local url = inputBox.Text:match("^%s*(.-)%s*$")

    if url == "" then
        statusLabel.Text = "âŒ URL tidak boleh kosong!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end

    if not url:find("discord.com/api/webhooks/") then
        statusLabel.Text = "âŒ URL tidak valid! Pastikan dari Discord Webhook."
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end

    statusLabel.Text = "âœ… Webhook diterima! Sistem aktif..."
    statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)

    wait(1)
    gui:Destroy()

    startFishListener(url)

    StarterGui:SetCore("SendNotification", {
        Title = "ğŸ£ Fish It Notifier",
        Text = "Notifikasi Discord aktif! Tunggu sampai dapat ikan.",
        Duration = 5
    })
end)